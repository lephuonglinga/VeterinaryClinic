<Page x:Class="VeterinaryClinic.AdminView.AdminDashboardPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:local="clr-namespace:VeterinaryClinic.AdminView"
      xmlns:views="clr-namespace:VeterinaryClinic.Views"
      mc:Ignorable="d"
      d:DesignHeight="900"
      d:DesignWidth="1100"
      Title="AdminDashboardPage">

    <Page.Resources>
        <!-- Modern Button Style -->
        <Style x:Key="ModernButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#2563EB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#1D4ED8"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#1E40AF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Action Button Style -->
        <Style x:Key="ActionButtonStyle" TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
            <Setter Property="Background" Value="#059669"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#047857"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#065f46"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Modern TextBox Style -->
        <Style x:Key="ModernTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#111827"/>
            <Setter Property="BorderBrush" Value="#D1D5DB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="5, 2"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="8">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                          Margin="{TemplateBinding Padding}"
                                          VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="#2563EB"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="#9CA3AF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Card Style DataGrid -->
        <Style x:Key="CardDataGridStyle" TargetType="DataGrid">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="RowBackground" Value="Transparent"/>
            <Setter Property="AlternatingRowBackground" Value="Transparent"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="RowHeight" Value="36"/>
            <Setter Property="CanUserReorderColumns" Value="False"/>
            <Setter Property="CanUserResizeColumns" Value="True"/>
            <Setter Property="CanUserSortColumns" Value="True"/>
            <Setter Property="SelectionMode" Value="Extended"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
        </Style>

        <!-- Card Row Style -->
        <Style x:Key="CardRowStyle" TargetType="DataGridRow">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Margin" Value="0,0,0,2"/>
            <!-- Reduced gap -->
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridRow">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                BorderBrush="#E5E7EB" 
                                BorderThickness="1"
                                Margin="{TemplateBinding Margin}">
                            <Border.Effect>
                                <DropShadowEffect Color="#000000" 
                                                  Opacity="0.05" 
                                                  BlurRadius="6" 
                                                  ShadowDepth="1"/>
                            </Border.Effect>
                            <DataGridCellsPresenter Margin="8"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#EFF6FF"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#BFDBFE"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Card Cell Style -->
        <Style x:Key="CardCellStyle" TargetType="DataGridCell">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="12,4"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <ContentPresenter VerticalAlignment="Center"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Summary Card Style -->
        <Style x:Key="StatCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="BorderBrush" Value="#E5E7EB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#000000" Opacity="0.05" BlurRadius="8" ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid Background="#F8FAFC">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Sidebar -->
        <views:AdminSidebar Grid.Column="0" />

        <!-- Main Content -->
        <ScrollViewer Grid.Column="1" Margin="24" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel>

                <!-- Page Header -->
                <Border Background="White" CornerRadius="12" Padding="24" Margin="0,0,0,24"
                        BorderBrush="#E5E7EB" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Admin Dashboard" FontSize="28" FontWeight="Bold" Foreground="#111827" Margin="0,0,0,8"/>
                        <TextBlock Text="View comprehensive statistics on clinic income, prescriptions, and inventory."
                                   FontSize="16" Foreground="#6B7280"/>
                    </StackPanel>
                </Border>

                <!-- Summary Cards Row -->
                <WrapPanel HorizontalAlignment="Stretch" VerticalAlignment="Top" Margin="0,0,0,24">
                    <Border Style="{StaticResource StatCardStyle}" Width="220" Height="120">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <TextBlock Text="Total Income" Foreground="#6B7280" FontWeight="SemiBold" FontSize="14" TextAlignment="Center"/>
                            <TextBlock x:Name="TotalIncomeText" Text="$0.00" FontSize="26" FontWeight="Bold" Foreground="#059669" TextAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource StatCardStyle}" Width="220" Height="120">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <TextBlock Text="Average Prescription Value" Foreground="#6B7280" FontWeight="SemiBold" FontSize="14" TextAlignment="Center"/>
                            <TextBlock x:Name="AvgPrescriptionValueText" Text="$0.00" FontSize="26" FontWeight="Bold" Foreground="#2563EB" TextAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource StatCardStyle}" Width="220" Height="120">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <TextBlock Text="Prescriptions This Year" Foreground="#6B7280" FontWeight="SemiBold" FontSize="14" TextAlignment="Center"/>
                            <TextBlock x:Name="PrescriptionsCountText" Text="0" FontSize="26" FontWeight="Bold" Foreground="#2563EB" TextAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource StatCardStyle}" Width="220" Height="120">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <TextBlock Text="Medications Expiring Soon" Foreground="#6B7280" FontWeight="SemiBold" FontSize="14" TextAlignment="Center"/>
                            <TextBlock x:Name="ExpiringMedsCountText" Text="0" FontSize="26" FontWeight="Bold" Foreground="#DC2626" TextAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </WrapPanel>

                <!-- Monthly Income Report -->
                <TextBlock Text="Monthly Income Report" FontSize="20" FontWeight="SemiBold" Foreground="#111827" Margin="6,16,0,3"/>
                <DataGrid Name="MonthlyIncomeDataGrid"
                          AutoGenerateColumns="False"
                          Style="{StaticResource CardDataGridStyle}"
                          RowStyle="{StaticResource CardRowStyle}"
                          CellStyle="{StaticResource CardCellStyle}"
                          CanUserAddRows="False"
                          Margin="0,0,0,24"
                          IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Month" Binding="{Binding MonthName}" Width="140"/>
                        <DataGridTextColumn Header="Total Income" Binding="{Binding TotalIncome, StringFormat=C}" Width="150"/>
                        <DataGridTextColumn Header="Prescriptions" Binding="{Binding TotalPrescriptions}" Width="150"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Top Revenue Medications -->
                <TextBlock Text="Top Revenue Medications" FontSize="20" FontWeight="SemiBold" Foreground="#111827" Margin="6,16,0,3"/>
                <DataGrid Name="TopMedicationsDataGrid"
                          AutoGenerateColumns="False"
                          Style="{StaticResource CardDataGridStyle}"
                          RowStyle="{StaticResource CardRowStyle}"
                          CellStyle="{StaticResource CardCellStyle}"
                          CanUserAddRows="False"
                          Margin="0,0,0,24"
                          IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Trade Name" Binding="{Binding TradeName}" Width="200"/>
                        <DataGridTextColumn Header="Generic Name" Binding="{Binding GenericName}" Width="200"/>
                        <DataGridTextColumn Header="Revenue" Binding="{Binding TotalRevenue, StringFormat=C}" Width="140"/>
                        <DataGridTextColumn Header="Qty Prescribed" Binding="{Binding TotalQuantityPrescribed}" Width="140"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Medication Profit Analysis -->
                <TextBlock Text="Medication Profit Analysis" FontSize="20" FontWeight="SemiBold" Foreground="#111827" Margin="6,16,0,3"/>
                <DataGrid Name="MedicationProfitDataGrid"
                          AutoGenerateColumns="False"
                          Style="{StaticResource CardDataGridStyle}"
                          RowStyle="{StaticResource CardRowStyle}"
                          CellStyle="{StaticResource CardCellStyle}"
                          CanUserAddRows="False"
                          Margin="0,0,0,24"
                          IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Trade Name" Binding="{Binding TradeName}" Width="180"/>
                        <DataGridTextColumn Header="Generic Name" Binding="{Binding GenericName}" Width="180"/>
                        <DataGridTextColumn Header="Total Revenue" Binding="{Binding TotalRevenue, StringFormat=C}" Width="130"/>
                        <DataGridTextColumn Header="Total Cost" Binding="{Binding TotalCost, StringFormat=C}" Width="130"/>
                        <DataGridTextColumn Header="Profit" Binding="{Binding TotalProfit, StringFormat=C}" Width="130"/>
                        <DataGridTextColumn Header="Profit %" Binding="{Binding ProfitMargin, StringFormat=N2}" Width="80"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Revenue by Category -->
                <TextBlock Text="Revenue by Category" FontSize="20" FontWeight="SemiBold" Foreground="#111827" Margin="6,16,0,3"/>
                <DataGrid Name="RevenueByCategoryDataGrid"
                          AutoGenerateColumns="False"
                          Style="{StaticResource CardDataGridStyle}"
                          RowStyle="{StaticResource CardRowStyle}"
                          CellStyle="{StaticResource CardCellStyle}"
                          CanUserAddRows="False"
                          Margin="0,0,0,24"
                          IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="200"/>
                        <DataGridTextColumn Header="Total Revenue" Binding="{Binding TotalRevenue, StringFormat=C}" Width="160"/>
                        <DataGridTextColumn Header="Quantity" Binding="{Binding TotalQuantity}" Width="100"/>
                        <DataGridTextColumn Header="Unique Items" Binding="{Binding UniqueItems}" Width="120"/>
                        <DataGridTextColumn Header="Prescriptions" Binding="{Binding PrescriptionCount}" Width="120"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Expiring Medications Alert -->
                <TextBlock Text="Expiring Medications (Next 30 Days)" FontSize="20" FontWeight="SemiBold" Foreground="#111827" Margin="6,16,0,3"/>
                <DataGrid Name="ExpiringMedicationsDataGrid"
                          AutoGenerateColumns="False"
                          Style="{StaticResource CardDataGridStyle}"
                          RowStyle="{StaticResource CardRowStyle}"
                          CellStyle="{StaticResource CardCellStyle}"
                          CanUserAddRows="False"
                          Margin="0,0,0,24"
                          IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Trade Name" Binding="{Binding TradeName}" Width="200"/>
                        <DataGridTextColumn Header="Generic Name" Binding="{Binding GenericName}" Width="200"/>
                        <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="140"/>
                        <DataGridTextColumn Header="Expires On" Binding="{Binding ExpirationDate, StringFormat='MMM dd, yyyy'}" Width="140"/>
                        <DataGridTextColumn Header="Days To Expiry" Binding="{Binding DaysUntilExpiry}" Width="110"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Most Prescribed Medications -->
                <TextBlock Text="Most Prescribed Medications" FontSize="20" FontWeight="SemiBold" Foreground="#111827" Margin="6,16,0,12"/>
                <DataGrid Name="MostPrescribedMedicationsDataGrid"
                          AutoGenerateColumns="False"
                          Style="{StaticResource CardDataGridStyle}"
                          RowStyle="{StaticResource CardRowStyle}"
                          CellStyle="{StaticResource CardCellStyle}"
                          CanUserAddRows="False"
                          Margin="0,0,0,40"
                          IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Trade Name" Binding="{Binding TradeName}" Width="200"/>
                        <DataGridTextColumn Header="Generic Name" Binding="{Binding GenericName}" Width="200"/>
                        <DataGridTextColumn Header="Prescriptions" Binding="{Binding TotalPrescriptions}" Width="140"/>
                        <DataGridTextColumn Header="Total Quantity" Binding="{Binding TotalQuantity}" Width="140"/>
                        <DataGridTextColumn Header="Last Prescribed" Binding="{Binding LastPrescribed, StringFormat='MMM dd, yyyy'}" Width="140"/>
                    </DataGrid.Columns>
                </DataGrid>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
